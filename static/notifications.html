<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="light-content">
    <meta name="apple-mobile-web-app-title" content="Toyota Dashboard">
    <title>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è - Toyota Dashboard</title>
    
    <!-- PWA –º–∞–Ω–∏—Ñ–µ—Å—Ç -->
    <link rel="manifest" href="/static/manifest.json">
    
    <!-- –°—Ç–∏–ª–∏ -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, sans-serif;
            background: #f8f9fa;
            color: #1d1d1f;
            min-height: 100vh;
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
        }
        
        .container {
            max-width: 414px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }
        
        .header {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px 0;
        }
        
        .back-btn {
            background: #ffffff;
            border: 1px solid #e5e5e7;
            border-radius: 12px;
            padding: 12px;
            margin-right: 16px;
            cursor: pointer;
            font-size: 18px;
            color: #eb0a1e;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 44px;
            height: 44px;
        }
        
        .header h1 {
            font-size: 28px;
            font-weight: 700;
            color: #1d1d1f;
            letter-spacing: -0.5px;
        }
        
        .notification-card {
            background: #ffffff;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(0, 0, 0, 0.04);
            position: relative;
        }
        
        .notification-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }
        
        .notification-category {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .notification-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }
        
        .notification-icon.alert {
            background: #ff3b30;
            color: white;
        }
        
        .notification-icon.charging {
            background: #30d158;
            color: white;
        }
        
        .notification-icon.command {
            background: #007aff;
            color: white;
        }
        
        .notification-icon.climate {
            background: #5ac8fa;
            color: white;
        }
        
        .notification-icon.update {
            background: #ff9500;
            color: white;
        }
        
        .notification-type {
            font-size: 15px;
            font-weight: 600;
            color: #1d1d1f;
        }
        
        .notification-time {
            font-size: 13px;
            color: #86868b;
            font-weight: 500;
        }
        
        .notification-message {
            font-size: 15px;
            color: #1d1d1f;
            line-height: 1.4;
        }
        
        .unread-indicator {
            position: absolute;
            top: 16px;
            right: 16px;
            width: 8px;
            height: 8px;
            background: #eb0a1e;
            border-radius: 50%;
        }
        
        .filter-bar {
            display: flex;
            background: #ffffff;
            border-radius: 16px;
            padding: 8px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(0, 0, 0, 0.04);
            overflow-x: auto;
        }
        
        .filter-btn {
            background: transparent;
            border: none;
            padding: 8px 16px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            color: #86868b;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
        }
        
        .filter-btn.active {
            background: #eb0a1e;
            color: #ffffff;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #86868b;
        }
        
        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }
        
        .empty-state-text {
            font-size: 17px;
            font-weight: 500;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #86868b;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <div class="header">
            <a href="/" class="back-btn">‚Üê</a>
            <h1>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h1>
        </div>
        
        <!-- –§–∏–ª—å—Ç—Ä—ã -->
        <div class="filter-bar">
            <button class="filter-btn active" onclick="filterNotifications('all')">–í—Å–µ</button>
            <button class="filter-btn" onclick="filterNotifications('alert')">–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è</button>
            <button class="filter-btn" onclick="filterNotifications('charging')">–ó–∞—Ä—è–¥–∫–∞</button>
            <button class="filter-btn" onclick="filterNotifications('command')">–ö–æ–º–∞–Ω–¥—ã</button>
            <button class="filter-btn" onclick="filterNotifications('climate')">–ö–ª–∏–º–∞—Ç</button>
        </div>
        
        <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
        <div id="notifications-container">
            <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π...</div>
        </div>
    </div>
    
    <script>
        let notifications = [];
        let currentFilter = 'all';
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            loadNotifications();
        });
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        async function loadNotifications() {
            try {
                const response = await fetch('/api/vehicle/notifications');
                if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π');
                
                const data = await response.json();
                notifications = data.notifications || [];
                renderNotifications();
                
            } catch (error) {
                document.getElementById('notifications-container').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">‚ö†Ô∏è</div>
                        <div class="empty-state-text">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</div>
                    </div>
                `;
                console.error('Error:', error);
            }
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        function renderNotifications() {
            const container = document.getElementById('notifications-container');
            
            let filteredNotifications = notifications;
            if (currentFilter !== 'all') {
                filteredNotifications = notifications.filter(n => 
                    (n.type || '').toLowerCase().includes(currentFilter.toLowerCase())
                );
            }
            
            if (filteredNotifications.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üì≠</div>
                        <div class="empty-state-text">–ù–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</div>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = filteredNotifications.map(notification => `
                <div class="notification-card">
                    ${!notification.read ? '<div class="unread-indicator"></div>' : ''}
                    <div class="notification-header">
                        <div class="notification-category">
                            <div class="notification-icon ${getCategoryClass(notification.type)}">
                                ${getCategoryIcon(notification.type)}
                            </div>
                            <span class="notification-type">${getCategoryName(notification.type)}</span>
                        </div>
                        <span class="notification-time">${formatTime(notification.timestamp)}</span>
                    </div>
                    <div class="notification-message">${notification.message}</div>
                </div>
            `).join('');
        }
        
        // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        function filterNotifications(filter) {
            currentFilter = filter;
            
            // –û–±–Ω–æ–≤–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            renderNotifications();
        }
        
        // –ü–æ–ª—É—á–∏—Ç—å –∫–ª–∞—Å—Å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        function getCategoryClass(category) {
            const categoryMap = {
                'info': 'alert',
                'success': 'charging',
                'warning': 'alert',
                'error': 'alert',
                'VehicleStatusAlert': 'alert',
                'ChargingAlert': 'charging',
                'RemoteCommand': 'command',
                'ScheduledClimate': 'climate',
                'UpdateSchedule': 'update'
            };
            return categoryMap[category] || 'alert';
        }
        
        // –ü–æ–ª—É—á–∏—Ç—å –∏–∫–æ–Ω–∫—É –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        function getCategoryIcon(category) {
            const iconMap = {
                'info': 'üì¢',
                'success': '‚úÖ',
                'warning': '‚ö†Ô∏è',
                'error': '‚ùå',
                'VehicleStatusAlert': '‚ö†Ô∏è',
                'ChargingAlert': 'üîã',
                'RemoteCommand': 'üì±',
                'ScheduledClimate': '‚ùÑÔ∏è',
                'UpdateSchedule': 'üîÑ'
            };
            return iconMap[category] || 'üì¢';
        }
        
        // –ü–æ–ª—É—á–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        function getCategoryName(category) {
            const nameMap = {
                'info': '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è',
                'success': '–£—Å–ø–µ—à–Ω–æ',
                'warning': '–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ',
                'error': '–û—à–∏–±–∫–∞',
                'VehicleStatusAlert': '–°—Ç–∞—Ç—É—Å –∞–≤—Ç–æ–º–æ–±–∏–ª—è',
                'ChargingAlert': '–ó–∞—Ä—è–¥–∫–∞',
                'RemoteCommand': '–£–¥–∞–ª–µ–Ω–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞',
                'ScheduledClimate': '–ö–ª–∏–º–∞—Ç-–∫–æ–Ω—Ç—Ä–æ–ª—å',
                'UpdateSchedule': '–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è'
            };
            return nameMap[category] || category || '–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ';
        }
        
        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
        function formatTime(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMins / 60);
            const diffDays = Math.floor(diffHours / 24);
            
            if (diffMins < 1) return '–¢–æ–ª—å–∫–æ —á—Ç–æ';
            if (diffMins < 60) return `${diffMins} –º–∏–Ω –Ω–∞–∑–∞–¥`;
            if (diffHours < 24) return `${diffHours} —á –Ω–∞–∑–∞–¥`;
            if (diffDays < 7) return `${diffDays} –¥–Ω –Ω–∞–∑–∞–¥`;
            
            return date.toLocaleDateString('ru-RU', {
                day: 'numeric',
                month: 'short',
                year: date.getFullYear() !== now.getFullYear() ? 'numeric' : undefined
            });
        }
    </script>
</body>
</html>