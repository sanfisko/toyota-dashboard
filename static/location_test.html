<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è - Toyota Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .back-btn {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 10px 20px;
            text-decoration: none;
            border-radius: 8px;
            margin-bottom: 20px;
            transition: background 0.3s;
        }

        .back-btn:hover {
            background: #5a6fd8;
        }

        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            background: #f9f9f9;
        }

        .test-section h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.5rem;
        }

        .test-button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 10px 10px 0;
            transition: background 0.3s;
        }

        .test-button:hover {
            background: #45a049;
        }

        .test-button:disabled {
            background: #cccccc;
            cursor: not-allowed;
        }

        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            background: white;
            border-left: 4px solid #667eea;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            color: #f44336;
            background: #ffebee;
            border-left-color: #f44336;
        }

        .success {
            color: #4CAF50;
            background: #e8f5e8;
            border-left-color: #4CAF50;
        }

        .info {
            color: #2196F3;
            background: #e3f2fd;
            border-left-color: #2196F3;
        }

        .map-container {
            width: 100%;
            height: 400px;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-top: 15px;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
        }

        .coordinates {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .coordinate-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }

        .coordinate-label {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .coordinate-value {
            font-family: monospace;
            font-size: 14px;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üó∫Ô∏è –¢–µ—Å—Ç –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è</h1>
            <p>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è –∏ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏</p>
        </div>

        <div class="content">
            <a href="/" class="back-btn">‚Üê –ù–∞–∑–∞–¥ –∫ –≥–ª–∞–≤–Ω–æ–π</a>

            <!-- –¢–µ—Å—Ç –ø–æ–ª—É—á–µ–Ω–∏—è –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è –∞–≤—Ç–æ–º–æ–±–∏–ª—è -->
            <div class="test-section">
                <h2>üìç –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –∞–≤—Ç–æ–º–æ–±–∏–ª—è</h2>
                <p>–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è –∞–≤—Ç–æ–º–æ–±–∏–ª—è —á–µ—Ä–µ–∑ Toyota API</p>
                <button class="test-button" onclick="testVehicleLocation()">–ü–æ–ª—É—á–∏—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ</button>
                <div id="vehicle-location-loading" class="loading">
                    <div class="spinner"></div>
                    <p>–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–∏...</p>
                </div>
                <div id="vehicle-location-result"></div>
            </div>

            <!-- –¢–µ—Å—Ç –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –±—Ä–∞—É–∑–µ—Ä–∞ -->
            <div class="test-section">
                <h2>üåê –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –±—Ä–∞—É–∑–µ—Ä–∞</h2>
                <p>–ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä (—Ç—Ä–µ–±—É–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è)</p>
                <button class="test-button" onclick="testBrowserLocation()">–ü–æ–ª—É—á–∏—Ç—å –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é</button>
                <div id="browser-location-loading" class="loading">
                    <div class="spinner"></div>
                    <p>–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è...</p>
                </div>
                <div id="browser-location-result"></div>
            </div>

            <!-- –¢–µ—Å—Ç —Ü–µ–Ω –Ω–∞ —Ç–æ–ø–ª–∏–≤–æ -->
            <div class="test-section">
                <h2>‚õΩ –¶–µ–Ω—ã –Ω–∞ —Ç–æ–ø–ª–∏–≤–æ</h2>
                <p>–ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö —Ü–µ–Ω –Ω–∞ —Ç–æ–ø–ª–∏–≤–æ –≤ —Ä–µ–≥–∏–æ–Ω–µ</p>
                <button class="test-button" onclick="testFuelPrices()">–ü–æ–ª—É—á–∏—Ç—å —Ü–µ–Ω—ã</button>
                <div id="fuel-prices-loading" class="loading">
                    <div class="spinner"></div>
                    <p>–ó–∞–≥—Ä—É–∑–∫–∞ —Ü–µ–Ω –Ω–∞ —Ç–æ–ø–ª–∏–≤–æ...</p>
                </div>
                <div id="fuel-prices-result"></div>
            </div>

            <!-- –¢–µ—Å—Ç API –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è -->
            <div class="test-section">
                <h2>üîó API –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è</h2>
                <p>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API endpoint –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–∏</p>
                <button class="test-button" onclick="testLocationAPI()">–¢–µ—Å—Ç API</button>
                <div id="location-api-loading" class="loading">
                    <div class="spinner"></div>
                    <p>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API...</p>
                </div>
                <div id="location-api-result"></div>
            </div>
        </div>
    </div>

    <script>
        // –¢–µ—Å—Ç –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è –∞–≤—Ç–æ–º–æ–±–∏–ª—è
        async function testVehicleLocation() {
            const loading = document.getElementById('vehicle-location-loading');
            const result = document.getElementById('vehicle-location-result');
            
            loading.style.display = 'block';
            result.innerHTML = '';

            try {
                const response = await fetch('/api/vehicle/location');
                const data = await response.json();

                if (response.ok) {
                    result.innerHTML = `
                        <div class="result success">
                            <h3>‚úÖ –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–æ</h3>
                            <div class="coordinates">
                                <div class="coordinate-item">
                                    <div class="coordinate-label">–®–∏—Ä–æ—Ç–∞</div>
                                    <div class="coordinate-value">${data.latitude || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞'}</div>
                                </div>
                                <div class="coordinate-item">
                                    <div class="coordinate-label">–î–æ–ª–≥–æ—Ç–∞</div>
                                    <div class="coordinate-value">${data.longitude || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞'}</div>
                                </div>
                                <div class="coordinate-item">
                                    <div class="coordinate-label">–ê–¥—Ä–µ—Å</div>
                                    <div class="coordinate-value">${data.address || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω'}</div>
                                </div>
                                <div class="coordinate-item">
                                    <div class="coordinate-label">–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ</div>
                                    <div class="coordinate-value">${data.last_updated || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}</div>
                                </div>
                            </div>
                            ${data.fuel_prices ? `
                                <h4 style="margin-top: 15px; color: #667eea;">–¶–µ–Ω—ã –Ω–∞ —Ç–æ–ø–ª–∏–≤–æ:</h4>
                                <div class="coordinates">
                                    <div class="coordinate-item">
                                        <div class="coordinate-label">–ë–µ–Ω–∑–∏–Ω</div>
                                        <div class="coordinate-value">${data.fuel_prices.gasoline || '–ù/–î'} ‚Ç¨/–ª</div>
                                    </div>
                                    <div class="coordinate-item">
                                        <div class="coordinate-label">–î–∏–∑–µ–ª—å</div>
                                        <div class="coordinate-value">${data.fuel_prices.diesel || '–ù/–î'} ‚Ç¨/–ª</div>
                                    </div>
                                    <div class="coordinate-item">
                                        <div class="coordinate-label">–≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–æ</div>
                                        <div class="coordinate-value">${data.fuel_prices.electricity || '–ù/–î'} ‚Ç¨/–∫–í—Ç‚ãÖ—á</div>
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    `;
                } else {
                    throw new Error(data.detail || '–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö');
                }
            } catch (error) {
                result.innerHTML = `
                    <div class="result error">
                        <h3>‚ùå –û—à–∏–±–∫–∞</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            } finally {
                loading.style.display = 'none';
            }
        }

        // –¢–µ—Å—Ç –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –±—Ä–∞—É–∑–µ—Ä–∞
        function testBrowserLocation() {
            const loading = document.getElementById('browser-location-loading');
            const result = document.getElementById('browser-location-result');
            
            loading.style.display = 'block';
            result.innerHTML = '';

            if (!navigator.geolocation) {
                result.innerHTML = `
                    <div class="result error">
                        <h3>‚ùå –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è</h3>
                        <p>–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é</p>
                    </div>
                `;
                loading.style.display = 'none';
                return;
            }

            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const { latitude, longitude, accuracy } = position.coords;
                    result.innerHTML = `
                        <div class="result success">
                            <h3>‚úÖ –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞</h3>
                            <div class="coordinates">
                                <div class="coordinate-item">
                                    <div class="coordinate-label">–®–∏—Ä–æ—Ç–∞</div>
                                    <div class="coordinate-value">${latitude.toFixed(6)}</div>
                                </div>
                                <div class="coordinate-item">
                                    <div class="coordinate-label">–î–æ–ª–≥–æ—Ç–∞</div>
                                    <div class="coordinate-value">${longitude.toFixed(6)}</div>
                                </div>
                                <div class="coordinate-item">
                                    <div class="coordinate-label">–¢–æ—á–Ω–æ—Å—Ç—å</div>
                                    <div class="coordinate-value">${Math.round(accuracy)} –º</div>
                                </div>
                                <div class="coordinate-item">
                                    <div class="coordinate-label">–í—Ä–µ–º—è</div>
                                    <div class="coordinate-value">${new Date().toLocaleString()}</div>
                                </div>
                            </div>
                        </div>
                    `;
                    loading.style.display = 'none';
                },
                (error) => {
                    let errorMessage = '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞';
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            errorMessage = '–î–æ—Å—Ç—É–ø –∫ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –∑–∞–ø—Ä–µ—â–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMessage = '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞';
                            break;
                        case error.TIMEOUT:
                            errorMessage = '–í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è –∏—Å—Ç–µ–∫–ª–æ';
                            break;
                    }
                    
                    result.innerHTML = `
                        <div class="result error">
                            <h3>‚ùå –û—à–∏–±–∫–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏</h3>
                            <p>${errorMessage}</p>
                        </div>
                    `;
                    loading.style.display = 'none';
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 0
                }
            );
        }

        // –¢–µ—Å—Ç —Ü–µ–Ω –Ω–∞ —Ç–æ–ø–ª–∏–≤–æ
        async function testFuelPrices() {
            const loading = document.getElementById('fuel-prices-loading');
            const result = document.getElementById('fuel-prices-result');
            
            loading.style.display = 'block';
            result.innerHTML = '';

            try {
                const response = await fetch('/api/fuel-prices');
                const data = await response.json();

                if (response.ok) {
                    result.innerHTML = `
                        <div class="result success">
                            <h3>‚úÖ –¶–µ–Ω—ã –Ω–∞ —Ç–æ–ø–ª–∏–≤–æ –ø–æ–ª—É—á–µ–Ω—ã</h3>
                            <div class="coordinates">
                                <div class="coordinate-item">
                                    <div class="coordinate-label">–ë–µ–Ω–∑–∏–Ω</div>
                                    <div class="coordinate-value">${data.gasoline || '–ù/–î'} ‚Ç¨/–ª</div>
                                </div>
                                <div class="coordinate-item">
                                    <div class="coordinate-label">–î–∏–∑–µ–ª—å</div>
                                    <div class="coordinate-value">${data.diesel || '–ù/–î'} ‚Ç¨/–ª</div>
                                </div>
                                <div class="coordinate-item">
                                    <div class="coordinate-label">–≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–æ</div>
                                    <div class="coordinate-value">${data.electricity || '–ù/–î'} ‚Ç¨/–∫–í—Ç‚ãÖ—á</div>
                                </div>
                                <div class="coordinate-item">
                                    <div class="coordinate-label">–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ</div>
                                    <div class="coordinate-value">${data.last_updated || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}</div>
                                </div>
                            </div>
                        </div>
                    `;
                } else {
                    throw new Error(data.detail || '–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ü–µ–Ω');
                }
            } catch (error) {
                result.innerHTML = `
                    <div class="result error">
                        <h3>‚ùå –û—à–∏–±–∫–∞</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            } finally {
                loading.style.display = 'none';
            }
        }

        // –¢–µ—Å—Ç API –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è
        async function testLocationAPI() {
            const loading = document.getElementById('location-api-loading');
            const result = document.getElementById('location-api-result');
            
            loading.style.display = 'block';
            result.innerHTML = '';

            try {
                const response = await fetch('/api/vehicle/location');
                const data = await response.json();

                result.innerHTML = `
                    <div class="result ${response.ok ? 'success' : 'error'}">
                        <h3>${response.ok ? '‚úÖ' : '‚ùå'} API Response (${response.status})</h3>
                        <pre style="background: #f5f5f5; padding: 15px; border-radius: 5px; overflow-x: auto; margin-top: 10px;">${JSON.stringify(data, null, 2)}</pre>
                    </div>
                `;
            } catch (error) {
                result.innerHTML = `
                    <div class="result error">
                        <h3>‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            } finally {
                loading.style.display = 'none';
            }
        }
    </script>
</body>
</html>