#!/bin/bash

# –¢–µ—Å—Ç –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ –∫–æ–º–∞–Ω–¥ Python

set -e

echo "üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è..."

# –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤–æ–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
TEST_DIR="/tmp/test-venv-toyota"
rm -rf "$TEST_DIR"
mkdir -p "$TEST_DIR"
cd "$TEST_DIR"

echo "üìÅ –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è..."
python3 -m venv test_venv

echo "üîß –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥ –≤ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏..."

# –¢–µ—Å—Ç–∏—Ä—É–µ–º –∫–æ–º–∞–Ω–¥—É –≤ —Ç–æ–º –∂–µ —Ñ–æ—Ä–º–∞—Ç–µ, —á—Ç–æ –∏ –≤ install.sh
bash -c "
    source test_venv/bin/activate
    echo '‚úì –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ'
    python3 -c 'import sys; print(\"‚úì Python –≤–µ—Ä—Å–∏—è:\", sys.version.split()[0])'
    python3 -c 'import sys; print(\"‚úì –¢–µ—Å—Ç getattr:\", getattr(sys, \"version_info\", \"—Ç–µ—Å—Ç\"))'
"

echo "üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º–Ω–æ–π –∫–æ–º–∞–Ω–¥—ã..."
bash -c "
    source test_venv/bin/activate
    python3 -c 'import sys; print(\"‚úì PyToyoda —Ç–µ—Å—Ç:\", getattr(sys, \"__version__\", \"–ª–æ–∫–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è\"))'
" || echo "‚ùå –û—à–∏–±–∫–∞ –≤ –∫–æ–º–∞–Ω–¥–µ"

echo "üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –∫–∞–≤—ã—á–∫–∞–º–∏..."
bash -c "
    source test_venv/bin/activate
    python3 -c 'import sys; print(\"‚úì PyToyoda —Ç–µ—Å—Ç:\", getattr(sys, \"__version__\", \"–ª–æ–∫–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è\"))'
" || echo "‚ùå –û—à–∏–±–∫–∞ –≤ –∫–æ–º–∞–Ω–¥–µ —Å —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –∫–∞–≤—ã—á–∫–∞–º–∏"

# –û—á–∏—Å—Ç–∫–∞
cd /
rm -rf "$TEST_DIR"

echo "‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ"