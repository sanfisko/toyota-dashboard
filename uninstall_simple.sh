#!/bin/bash

# Toyota Dashboard - –ü—Ä–æ—Å—Ç–æ–π —Å–∫—Ä–∏–ø—Ç —É–¥–∞–ª–µ–Ω–∏—è
# –ê–≤—Ç–æ—Ä: OpenHands AI Assistant
# –í–µ—Ä—Å–∏—è: 2.0

echo "üóëÔ∏è  Toyota Dashboard - –£–¥–∞–ª–µ–Ω–∏–µ"
echo "================================"

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
echo "üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è..."
pkill -f "python app.py" || true
pkill -f "uvicorn" || true

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ systemd —Å–µ—Ä–≤–∏—Å–∞
if command -v systemctl &> /dev/null && systemctl is-active --quiet toyota-dashboard; then
    echo "üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ systemd —Å–µ—Ä–≤–∏—Å–∞..."
    sudo systemctl stop toyota-dashboard
    sudo systemctl disable toyota-dashboard
    sudo rm -f /etc/systemd/system/toyota-dashboard.service
    sudo systemctl daemon-reload
    echo "‚úÖ Systemd —Å–µ—Ä–≤–∏—Å —É–¥–∞–ª–µ–Ω"
fi

# –£–¥–∞–ª–µ–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
echo "üì¶ –£–¥–∞–ª–µ–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è..."
rm -rf venv
echo "‚úÖ –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ"

# –£–¥–∞–ª–µ–Ω–∏–µ –∫—ç—à–∞
echo "üóëÔ∏è  –£–¥–∞–ª–µ–Ω–∏–µ –∫—ç—à–∞..."
rm -rf cache
rm -rf __pycache__
rm -rf .pytest_cache
echo "‚úÖ –ö—ç—à —É–¥–∞–ª–µ–Ω"

# –£–¥–∞–ª–µ–Ω–∏–µ –ª–æ–≥–æ–≤
read -p "–£–¥–∞–ª–∏—Ç—å –ª–æ–≥–∏? (y/N): " -n 1 -r
echo
if [[ $REPLY =~ ^[Yy]$ ]]; then
    rm -rf logs
    echo "‚úÖ –õ–æ–≥–∏ —É–¥–∞–ª–µ–Ω—ã"
fi

# –£–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
read -p "–£–¥–∞–ª–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏ –¥–∞–Ω–Ω—ã–µ? (y/N): " -n 1 -r
echo
if [[ $REPLY =~ ^[Yy]$ ]]; then
    rm -rf data
    echo "‚úÖ –î–∞–Ω–Ω—ã–µ —É–¥–∞–ª–µ–Ω—ã"
fi

# –£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
read -p "–£–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª? (y/N): " -n 1 -r
echo
if [[ $REPLY =~ ^[Yy]$ ]]; then
    rm -f config.yaml
    echo "‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —É–¥–∞–ª–µ–Ω–∞"
fi

# –£–¥–∞–ª–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤
echo "üóëÔ∏è  –£–¥–∞–ª–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤..."
rm -f start.sh
rm -f stop.sh
echo "‚úÖ –°–∫—Ä–∏–ø—Ç—ã —É–¥–∞–ª–µ–Ω—ã"

echo ""
echo "üéâ –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!"
echo ""
echo "üìã –ß—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å:"
echo "   - –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (app.py, static/, etc.)"
echo "   - –§–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (–µ—Å–ª–∏ –Ω–µ —É–¥–∞–ª–∏–ª–∏)"
echo "   - –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (–µ—Å–ª–∏ –Ω–µ —É–¥–∞–ª–∏–ª–∏)"
echo ""
echo "–î–ª—è –ø–æ–ª–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è —É–¥–∞–ª–∏—Ç–µ –≤—Å—é –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞."