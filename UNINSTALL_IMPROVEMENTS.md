# Улучшения uninstall.sh

## Обзор изменений

Скрипт `uninstall.sh` был полностью переработан для корректного удаления всех компонентов, установленных `install.sh`.

## Что было добавлено

### 1. Удаление базы данных и резервных копий
- Удаление директории `/var/lib/toyota-dashboard`
- Включает базу данных SQLite и все резервные копии

### 2. Удаление конфигурации логирования
- Удаление файла `/etc/logrotate.d/toyota-dashboard`
- Очистка конфигурации ротации логов

### 3. Удаление cron задач
- Полное удаление crontab пользователя toyota
- Удаление автоматических задач резервного копирования

### 4. Улучшенное удаление правил файрвола
- Корректное удаление правил UFW для портов 80 и 443
- Сохранение SSH правил для безопасности
- Поддержка как UFW, так и iptables

### 5. Безопасная очистка пакетов
- Автоматическая очистка неиспользуемых системных пакетов
- Сохранение Python пакетов для безопасности
- Поддержка различных пакетных менеджеров (apt, yum, dnf)

### 6. Новая функция remove_logging_and_cron()
- Централизованное удаление конфигурации логирования и cron задач
- Вызывается перед удалением пользователя

## Улучшения в отчетности

### Обновленный отчет об удалении
- Полный список удаленных компонентов
- Информация о сохраненных компонентах для безопасности
- Детальная информация о системе

### Улучшенные сообщения
- Более подробные предупреждения перед удалением
- Четкая информация о том, что будет удалено
- Информация о сохраненных компонентах

## Компоненты, которые теперь удаляются

✅ **Systemd сервис toyota-dashboard**
- Остановка и отключение сервиса
- Удаление файла сервиса
- Перезагрузка systemd

✅ **Файлы проекта (/opt/toyota-dashboard)**
- Все файлы приложения
- Виртуальное окружение Python
- Конфигурационные файлы

✅ **База данных и резервные копии (/var/lib/toyota-dashboard)**
- SQLite база данных
- Автоматические резервные копии
- Архивы конфигурации

✅ **Логи (/var/log/toyota-dashboard)**
- Все файлы логов приложения
- Системные логи

✅ **Пользователь toyota**
- Удаление пользователя и группы
- Удаление домашней директории
- Завершение всех процессов пользователя

✅ **Конфигурация nginx**
- Удаление конфигурации сайта
- Отключение сайта
- Перезагрузка nginx

✅ **Конфигурация logrotate**
- Удаление правил ротации логов

✅ **Cron задачи**
- Удаление всех cron задач пользователя toyota

✅ **Правила файрвола**
- Удаление правил для портов 80 и 443
- Сохранение SSH правил

✅ **Временные файлы**
- Очистка всех временных файлов

## Компоненты, сохраненные для безопасности

⚠️ **SSH правила файрвола** - сохранены для предотвращения блокировки доступа

⚠️ **Python пакеты** - не удаляются автоматически, так как могут использоваться другими приложениями

⚠️ **Системные пакеты** - nginx, sqlite3, git и другие системные пакеты сохранены

## Использование

```bash
# Интерактивное удаление
sudo ./uninstall.sh

# Автоматическое удаление
sudo ./uninstall.sh -y

# Удаление через curl
curl -sSL https://raw.githubusercontent.com/sanfisko/toyota-dashboard/main/uninstall.sh | sudo bash

# Справка
./uninstall.sh -h
```

## Безопасность

Скрипт разработан с учетом безопасности:
- Сохранение SSH доступа
- Подтверждение перед удалением
- Детальная отчетность
- Обработка ошибок
- Поддержка различных систем